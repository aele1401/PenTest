# Blue Team: Summary of Operations

## Table of Contents
- Network Topology
- Description of Targets
- Monitoring the Targets
- Patterns of Traffic & Behavior
- Suggestions for Going Further

### Network Topology

![Diagram](https://github.com/aele1401/PenTest/blob/main/RvB/Images/Pentest_Network_Diagram.PNG)

The following machines were identified on the network:
- Kali Machine
  * OS: Kali Linux
  * Role: Attack machine
  * IP: 192.168.1.90
- Target 1
  * OS: Debian Linux
  * Role: First target
  * IP: 192.168.1.110
- Target 2 
  * OS: Debian Linux
  * Role: Second target 
  * IP: 192.168.1.115
- ELK
  * OS: Ubuntu Linux
  * Role: ELK stack machine for network monitoring. Hosts Kibana & Elasticsearch.
  * IP: 192.168.1.100
- Capstone
  * OS: Ubuntu Linux
  * Role: Alert testing
  * IP: 192.168.1.105

### Description of Targets

The target of this attack was: `Target 1` (192.168.1.110).

Target 1 is an Apache web server and has SSH enabled, so ports 80 and 22 are possible ports of entry for attackers. As such, the following alerts have been implemented:

### Monitoring the Targets

Traffic to these services should be carefully monitored. To this end, these alerts have been implemented below:


#### Excessive HTTP Errors Alert

Alert 1 is implemented as follows:
  - **Metric**: WHEN count() GROUPED OVER top 5 'http.response.status_code' IS ABOVE 400 FOR THE LAST 5 minutes
  - **Threshold**: 400
  - **Vulnerability Mitigated**: Brute Force & Enumeration
  - **Reliability**: Alert is highly reliable as any normal responses will be filtered out. Alert is triggered after 400 threshold is exceeded.

#### HTTP Request Size Monitor Alert
Alert 2 is implemented as follows:
  - **Metric**: WHEN sum() of http.request.bytes OVER all documents IS ABOVE 3500 FOR THE LAST 1 minute
  - **Threshold**: 3500
  - **Vulnerability Mitigated**: Cross Site Scripting (XSS), DDOS, Directory Traversal
  - **Reliability**: In terms of reliability, alert is medium since it can generate false positives, such as large & legit HTTP traffic.

#### CPU Usage Monitor Alert
Alert 3 is implemented as follows:
  - **Metric**: WHEN max() OF system.process.cpu.total.pct OVER all documents IS ABOVE 0.5 FOR THE LAST 5 minutes
  - **Threshold**: 0.5
  - **Vulnerability Mitigated**: Malware & Viruses
  - **Reliability**: Alert is highly reliable since it shows what programs are running and how much resources is being used. It allows for the detection of malicious programs and improving CPU usage.

### Suggestions for Going Further

The logs and alerts generated during the assessment suggest that this network is susceptible to several active threats, identified by the alerts above. In addition to watching for occurrences of such threats, the network should be hardened against them. The Blue Team suggests that IT implement the fixes below to protect the network:
 #### Excessive HTTP Errors
  - **Patch**: WordPress service hardening
    * Update WordPress service
    * Implement proper security controls to servers & WordPress:
      * Filter requests made to the web server.
      * Disable the REST API feature within WordPress.
      * Secure user login information, this makes login information inaccessible to the public.
  - **Why It Works**: 
    * WPSCANS rely on REST API to enumerate users. Disabling the REST API feature prevents WPSCANS. 
    * Securing user login information from public access allows for a more secure environment since sensitive credentials are no longer accessible. This also prevents an attacker from dumping user password hashes. 
    * Updates to WordPress service ensures security by:
      * Fixes & patches to discovered vulnerabilities.
      * Performance & application improvements.
  #### HTTP Request Size Monitor
  - **Patch**: Input validation, query parameterization, and web application firewall.
    * Limitations on request sizes, strings, and URL inputs.
    * Input validation and query parameterization for fields requiring input.
    * Implement a web application firewall.
  - **Why It Works**: 
    * Implementing these limitations will reduce the size of traffic (400 errors), preventing a loss of availability.
    * Input validation, query parameterization, and web application firewalls prevent malicious code from being injected. This prevents the breach of confidentiality & integrity. 
  #### CPU Usage Monitor
  - **Patch**: System Hardening - Against Malware
    * Implement an Intrusion Detection System (IDS) and/or an Intrusion Prevention System (IPS).
    * Implement Endpoint Protection & Detection Response Tools (EDR, XDR, etc.)
    * Implement SIEM and SOAR tools.
    * Utilize antivirus tools.
  - **Why It Works**: 
    * IDS can monitor and detect malicious activity on the host system & network, giving real-time alerts to these activities. An IPS can protect against malicious attacks from the network layer up to the application layer. 
    * Antivirus and endpoint protection tools attempt to block the installation of malicious programs through identified signatures. EDR tools takes it a step further by not just identifying signatures, but through user entity and behavior analytics. SIEM tools collect logs and metrics from systems aggregating the data into an integrated environment like Splunk, Kibana, and Elasticsearch which can be used to analyze and visualize the data for application and infrastructure monitoring, faster troubleshooting, and security analytics. SOAR tools use the data collected from the SIEM to automate the response to security issues. These tools combined can protect systems and networks from malware, malicious, and unauthorized activity creating a secure environment for business operations.

