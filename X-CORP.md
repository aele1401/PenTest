# X-CORP

## Description
X-CORP is a comprehensive penetration testing and incident response project focused on evaluating the security posture of X-CORP's systems. This was done through simulating a Red Team and Blue Team environment, conducting a penetration test with modular, repeatable, and effective security testing processes while leveraging security tools for offensive security. As for defensive security, the task was to test, implement, and monitor alerts generated from SIEM and security tools to respond to security incidents. Also, to conduct network forensics to analyze and report on malicious activity not detected by security tools.

The project involves various stages of pentesting, including reconnaissance, vulnerability assessment, exploitation, and post-exploitation analysis. It also incorporates the incident response cycle, including preparation, identification, containment, eradication, recovery, and lessons learned. The primary goal is to identify potential vulnerabilities and threats within X-CORP systems, assess their impact, implement new alerts and detections using data analysis, and provide recommendations for mitigating these risks.

## Overview
You are working as a Security Engineer for X-CORP, supporting the SOC infrastructure. The SOC Analysts have noticed some discrepancies with alerting in the Kibana system and the manager has asked the Security Engineering team to investigate. You will start by confirming that newly created Kibana alerts are working, after which you will monitor live traffic on the wire to detect any abnormalities that are not reflected in the alerting system. You are to report back all your findings to both the SOC Manager and the Engineering Manager with appropriate analysis.

## Key Features
* **Offensive Security**:
    - Reconnaissance: Gathering information on the target system, including network mapping and identifying potential attack vectors.
    - Vulnerability Assessment: Scanning the sytem for vulnerabilities using industry-standard tools.
    - Exploitation: Attempting to exploit identified vulnerabilities to assess the extent of the security risk.
    - Post-Exploitation: Analyzing the impact of successful exploits, including privilege escalation and data exfiltration.
    - Reporting: Documenting findings, providing a risk assessment, and recommending security improvements.

* **Defensive Security**:
    - Preparation:
        * Establish a well-documented IR plan that has assigned roles and prepare tools, such as SIEM, EDR, scanner, alert testing, etc.
        * Set objectives and goals for the Red Team (phishing, lateral movement, etc.), and Blue Team (Define KPIs like MTTR.)
    - Identification:
        * Monitoring & Detection: Use monitoring tools like SIEM or IDS/IPS to detect unusual activity. Also, review logs, alerts, and network traffic for anomalies (e.g., spikes in outbound traffic, unauthorized access attempts).
        * Triage Alerts: Prioritize alerts based on severity and potential impact. Confirm whether it's a false positive or a legitimate incident.
    - Containment:
        * Immediate Actions: Disconnect affected systems from the network to prevent further spread. Apply firewall rules to block malicious IPs or domains.
        * Short-Term Containment: Isolate compromised accounts, endpoints, or servers while maintaining evidence integrity.
    - Eradication: 
        * Root Cause Analysis: Identify the root cause of the incident (e.g., exploited vulnerability, misconfigured system). Investigate using tools like memory forensics or malware analysis.
        * Remove Threats: Patch vulnerabilities, update software, and remove malware. Reconfigure access controls and security policies.
    - Recovery:
        * Restore Systems: Reinstall or restore affected systems using clean backups. Verify that systems are no longer compromised.
        * Monitor Post-Recovery: Watch for recurring signs of compromise. Increase monitoring on previously affected systems.
    - Lessons Learned:
        * Debrief & Document: For Red Team, provide a detailed report of tactics, techniques, and procedures (TTPs) used. As for Blue Team, document findings, response actions, and lessons learned.
        * Improve Defenses: Update playbooks, tools, and configurations based on gaps identified during the exercise. Conduct follow-up training or simulations to reinforce learning.

* Communication:
    - Internal Reporting:
        * Keep key stakeholders informed of progress during incident.
        * Use clear channels of communication for efficient coordination.
    - External Communication (if applicable):
        * Plan communication with affected parties, regulators, or the public in real-world scenarios.

## Tools & Technologies
- Network & Vulnerability Scanners: Nmap, Netcat, and Nikto
- Exploitation Framework & Tools: Metasploit & John the Ripper
- Scripting Languages: Python, PHP, and SQL
- SIEM Tools: ELK & Elasticsearch Watcher
- Network Forensics: Wireshark

## Table of Contents - Red Team 
This section contains the following resources:
- Network Topology
- Critical Vulnerabilities & Threats
- Exploits Used
- Avoiding Detection

## Table of Contents - Network Forensic Analysis
This section contains the following resources:
- Traffic Profiles
- Behavior Analysis
- Normal Activity
- Malicious Activity

## Table of Contents - Blue Team
This section contains the following resources:
- Alerts Implemented
- Hardening
- Implementing Patches
- Questions

## Network Topology
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Architecture/XCRP_Topology.PNG)

## Red Team - Offensive Security
### Critical Vulnerabilities & Threats
#### Reconnaissance - Describing the Target
Nmap scan identified the following hosts on the network:
|             Hostname          |   IP Address  | Role on Network                        |
|-------------------------------|---------------|----------------------------------------|
| Azure Hyper-V ML-REFVM-684427 | 192.168.1.1   | Host Machine                           |
|             Kali              | 192.168.1.90  | Attack Machine                         |
|           Target 1            | 192.168.1.110 | Target Machine (Hosts WordPress app)   |
|           Target 2            | 192.168.1.115 | Target Machine 2 (Hosts web server)    |
|             ELK               | 192.168.1.100 | ELK Machine (network & system monitor) |
|           Capstone            | 192.168.1.105 | Testing Environment Machine            |

#### Vulnerability Assessment

- Assessment uncovered the following vulnerabilities in **Target 1**:
    * **Open Ports (CAPEC-300)**: Ports 22, 80, 111, 137 – 139, and 4444 are open and not monitored. Open ports that are not monitored and controlled can allow an attacker to exploit the services running on those ports, using those ports as points of entry.
        - Impact:
            * SSH with discovered credentials.
            * Access to web servers and DOS attacks.
    * **Enumeration & Account Footprinting (CAPEC-575)**: Web application vulnerability that allows attackers to use brute force techniques to validate users on a network or service.
        - Impact:
            * User enumeration on WordPress app.
            * App susceptible to brute force and DOS attacks.
    * **Weak Credentials (CWE-521)**: Short names, first names, or any simple combinations.
        - Impact:
            * Passwords easy to obtain.
            * Non-complex combinations.
            * User accounts compromised.
    * **Misconfigured Security Controls (CWE-284, CAPEC-122, and OWASP Top 10)**: Improper controls are implemented leaving systems vulnerable to exploits.
        - Impact:
            * Unauthorized access to SQL Database.
            * Data exfiltration.
            * Hash and data dumping.
            * Privilege escalation with sudo and custom scripts.
            * winPEAS privilege escalation.
    * **Confidential Data Improperly Secured (CWE-219 & CWE-522)**: Confidential data, such as users’ personal information and login information, is easily accessible to the public with no security.
        - Impact:
            * Access to authentication logs.
            * "WP-config.php" file accessibl.e
            * Entire WP directory accessible.
    * **Brute Force Attack & Insufficient Security Measures (CWE-307 & CWE-49)**: An attack that consists of systematically checking all possible username and password combinations until the correct one is found.
        - Impact:
            * Improper access controls.
            * Multiple failed login attempts.
            * WordPress app susceptible to brute forcing and password attacks.
    * **Directory Path Traversal (CWE-23 & CAPEC-126)**: Improper access control and filtering allowing access to restricted and hidden directories.
        - Impact:
            * Access to authentication directories.
            * Access to configuration files.
            * Access to web directories.
    * **Unsalted Passwords & Insufficient Computational Effort (CWE-916)**: Salting is adding additional values to hashed passwords, changing the hash value produced.
        - Impact:
            * Usernames and passwords
            * Password cracking (John, Hydra, Hashcat, etc.)
    * **Privilege Escalation & Root Access (CWE-284 & CAPEC-233)**: A security hole created when code is executed with higher privileges than those of the user running it.
        - Impact:
            * Privilege escalation
            * Elevated permissions
            - System control & command line
            - Access as admin
    * **XML-RPC Parsing (CWE-611 & CAPEC-230)**: XML-RPC parsing is a WordPress feature that allows for XML documents to be transmitted in a user-friendly manner using HTTP as the transport method and XML for encoding.
        - Impact:
            * XML-RPC parsing susceptible
            * Pingback.ping
            * Botnets & DDOS
            * Loss of availability
    * **XML-RPC Ping (CAPEC-147)**: WordPress can use XML-RPC to communicate with systems. It is used to help users create posts offline by connecting WordPress with other applications and systems remotely.
        - Impact:
            * HTTP POST request smuggling
            * Bypass front-end security controls
            * Ping floods & DOS
            * Loss of availability
    * **Plaintext/Unencrypted Administrative Credentials (CWE-256 & CAPEC-37)**: Protocols and authentication methods that leave credentials unencrypted, like basic authentication and telnet.
        * Impact:
            - Accessible admin credentials
            - Admin access to SQL DB
            - Credential theft
            - Unauthorized access
    * **Cloudflare Protection Bypass (CAPEC-554)**: WordPress uses Cloudflare to increase site speed with a content delivery network.
        - Impact:
            * Pingback.ping & DNS Protection
            * DNS Exploitation & Corruption
            * Query manipulation
            * DNS spoofing, hijacking, flooding, and amplification
            * Loss of availability
    * **Insecure Designs (OWASP Top 10)**: Faulty application design and flaws in architecture that hackers can exploit. Occurs when teams don’t adhere to security best practices, and they fail to adequately anticipate and evaluate potential threats during the code design phase of creating an application.
        - Impact:
            * REST API allows enumeration
            * Code execution with higher privileges
            * Access to back-end configuration and authentication files
    * **Vulnerable & Outdated Components (OWASP Top 10)**: Components refer to software elements (such as libraries, frameworks, modules, or plugins) within an application that have known security weaknesses or flaws or software elements that are running on older versions, and there may be newer releases or patches available.
        - Impact:
            * REST API
            * Java Libraries
            * EOSL
            * Zero-days 
    * **Crytpographic Failures (OWASP Top 10)**: Use of weak encryption algorithms or short encryption keys which can make it easier for attackers to decrypt sensitive data.
        - Impact:
            * Insecure algorithms
            * Usage of weak keys
            * Protocol flaws
            * Downgrade attacks
    * **Injection (OWASP Top 10)**: Attacks that exploit vulnerabilities in input validation and inadequate data handling. Attackers inject data such as SQL queries, code snippets, or commands into web application forms or URLs. They allow adversaries to access sensitive data and manipulate an application’s behavior or gain access into the network/system.
        - XSS
        - SQL
        - Command
        - LDAP
        - XML
        - Impact:
            * Session hijacking with WordPress
            * Arbitrary user inputs
            * Custom sudo python scripts
            * SMB client exploitation
            * Lateral movements with SMB
            * XML-RPC exploitaion
- Assessment uncovered the following vulnerabilities in **Target 2**:
    * **Local File Inclusion - LFI (CAPEC-252)**: LFI is a vulnerability in poorly designed web applications. This allows users to upload content into the application or servers.
        - Impact:
            * Malicious Payloads
            * Remote Access Trojan (RAT)
            * Direct command line access
            * Advanced Persistent Threat (APT)
    * **Directory Path Traversal (CWE-23 & CAPEC-126)**: Accessing restricted web directories through command injection and URL manipulation of variables and parameters that reference files or directories.
        - Impact:
            * Root web directory access
            * Establishes persistence with configuration changes
- Assessment uncovered the following threats:
    * **Trojan Malware (CWE-507)**: Malicious computer virus disguised as a legitimate program, but carries a malicious, hidden payload that has the potential to wreak havoc on a system or network.
        - Impact:
            * Malware downloaded locally
            * Infected multiple hosts
            * Source of infection identified
            * Threat contained and eradicated
    * Unauthorized Domain Setup: Private Active Directory domain created without authorization.
        - Impact:
            * Private domain creation
            * Illegal Torrenting
            * Detection avoidance
    * Illegal Torrenting: Downloading and uploading copyrighted files through a network.
        - Impact:
            * Copyright violations
            * Legal ramifications

### Exploits Used
#### Exploitation
- Port Scanning: Nmap scan shows IP addresses, ranges, OS versions, services, and open ports.
    * Open ports:
        - Port 22 - SSH
        - Port 80 - Web
        - Port 111 - RPC
        - Port 139 - NetBIOS
        - Port 445 - SMB
        - Port 4444 - TCP
    * Running services:
        - WordPress
        - Apache
        - SSH, RPC, HTTP, TCP, and SMB
    * Port 80 provides access to web server
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/nmap_scan_report.png)
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/nmapscan.PNG)
- User Enumeration, Account Foot Printing, and LFI
    * Target 1 - WPSCAN to enumerate a list of site users (Michael & Steven)
        - `wpscan --url http://192.168.1.110/wordpress --enumerate u`
    * Target 2 - RAT uploaded to target for direct command line access
        - `nikto -C all -h 192.168.1.115
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/enumerate.png)
- SSH Using Discovered Credentials
    * SSH into target 1 machine: `SSH Michael@192.168.1.110`
    * Brute force password with guesses: `michael`
    * Granted user access
        - Michael's account compromised
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/michael.png)
- Weak User Credentials
    * Login with Michael's account
        - Michael's username and password were his first name
        - Password relatively easy to obtain through guessing
        - Online attack
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/michael.png)
- Misconfigured Security Controls
    * Privilege escalation without password (sudo python): `sudo python -c 'import pty;pty.spawn("/bin/bash")'`
    * Root shell access
    * *Recommendation: Steven's account should not have had access to run python with sudo and no password.*
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/sudo_python.png)
- Confidential Data Improperly Secured
    * Back-end files (wp-config.php) file not secured
    * Dump the wp_user table containing password hashes
    * Crack password with John the Ripper
    * Tables can hold personal information, PHI and PII
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/sql_login.png)
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/hashed_passwords.png)
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/nano_hashes.png)
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/john.PNG)
- Brute Force & Insufficient Security Measures
    * Passwords can be brute forced
    * No limits to failed login attempts
    * WordPress susceptible to enumeration
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/enumerate.png)
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/sa_and_bruteforce.png)

### Avoiding Detection
#### Stealth Exploitation of Port Scanning
- Monitoring Overiew:
    * HTTP Request Size Monitor Alert
    * Sum of request bytes exceed 3500 per minute
    * Alert triggered after 3500 bytes
- Mitigation Detection:
    * Stealth scans like SYN scan or decoy scan
    * Slower scans by adjusting timing parameters
    * Fragmentation by obscuring contents of the packets
    * Proxy chains and anonymization by rerouting scan traffic to obfuscate the source of the scans
    * Protocol-Based scanning using less common protocols like ICMP or SCTP
#### Stealth Exploitation of Enumeration
- Monitoring Overview:
    * Excessive HTTP Errors Alert
    * Top 5 response status codes exceed 400 every 5 minutes
    * Alert triggered after 400 threshold exceeded
- Mitigating Detection:
    * Enumerating is noisy
    * Stagger attempts
    * Reduce scan intensity 
    * Passive enumeration techniques
    * Stealthier scans, randomize timing, encrypt channels, and limit concurrent connections
#### Stealth Exploitation of LFI
- Monitoring Overview
    * CPU Usage Monitor Alert
    * CPU usage process exceeds 0.5/minute
    * Alert triggered after 50%
- Mitigation:
    * Alert is highly reliable
    * Fileless Malware & LOTL
    * Evade detection through refactoring
    * Obfuscation
    * Request splitting
    * User-agent spoofing
    * IP address rotation
    * Slow and Low technique
    * Bypass logging
    * Custom exploits

## Network Analysis 
### Traffic Profiles
#### Traffic Profile on 10.6.12.0/24
Wireshark analysis identified the following characteristics of the traffic on the network:
- Top talkers: 
    * 172.16.4.210
    * 185.243.121.24
    * 10.6.12.32
- Most common protocols: HTTP, TCP, and Telnet
- Number of unique IP addresses are the total IP addresses reported in scan.
- 1 malware species identified, a Trojan malware.

|        Feature        |                    Value                           |         Description
|-----------------------|----------------------------------------------------|---------------------------------------------------|
|      Top Talkers      |             ip.addr==10.6.12.0/24                  |  Machines that sent the most traffic              |
| Most Common Protocols |                  tcp && udp                        |  Most common protocols on the network             |
| # of Unique Addresses |                     560                            |  Count of observed IP addresses                   |
|   1 Malware Species   | ip.addr==10.6.12.0/24 && http.request.method==GET  |  Number of malware binaries identified in traffic |

### Behavior Analyses 
#### Normal Acitivty 
- Users were observed engaging in the following kinds of activity: 
    * Accessing public KBs
        - HTTPS to establish a secure connection to Microsoft’s website
        - User accessed files on creating private domains
    * Checking emails
    * Accessing intranet
        - HTTPS or TLS/TCP to establish a secure connection with the Google client or corporate website for intranet
        - Users authenticate to access email and/or intranet
        - Recommendation: MFA implementation when authenticating 
- Suspicious Activity:
    * Enumerating users - WPSCANS
    * Executing pingback.ping command
    * Manipulating URL to access hidden & restricted directories
    * Unauthorized access to DB and dumping hashes
    * Setting up a private Active Directory Domain

#### Malicious Activity
- Enumeration
    * Excessive HTTP errors (400 errors)
    * User ran a WPSCAN to enumerate potential users to target
        - Enumeration is noisy
        - Users targeted: Michael & Steven
- XML-RPC Ping & DDOS
    * Pingback commands to bypass DNS level protection to launch a Cloudflare attack
        - Command & Control - botnets 
        - DNS exploitation 
        - Persistence through changing configurations
- Unauthorized Access & Dumping Hashes
    * Improper implementation of security controls allows for exploitation
    * Port 22 allows for remote command execution with SSH
    * Malicious user can SSH with Michael's discovered credentials to access SQL server to dump hashes
    * SSH with Steven's credentials to escalate privileges to Root
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/hash_dump.png)

- Creating a Private Active Directory Domain
    * Private domain created on corporate network
    * Users were constantly browsing videos on YouTube
    * Trojan Malware downloaded from an unsecure site
        - Additional hosts infected
        - Hosts infected:
            * **185.243.115.84 - User of Interest & Potential Source of Infection**
            * 10.6.12.203
            * 172.16.4.205
            * 166.62.11.64
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/virus_total.png)
![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/Junedll_malware.png)

- Illegal Torrenting on Private Domain
    * Users torrenting on network
        - **Protocol Observed**: `HTTP`
        - **Traffic Analyzed**: `publicdomaintorrents.com`
        - **File of Interest**: `Betty_Boop_Rhythm_on_the_R eservation.avi.torrent`

![Diagram](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Images/torrenting.png)

## Blue Team - Defensive Security
### Alerts Implemented
- Excessive HTTP Errors Alert
    * Metric: WHEN count() GROUPED OVER top 5 'http.response.status_code' IS ABOVE 400 FOR THE LAST 5 minutes
    * Threshold: 400
    * Vulnerability Mitigated: Brute force & Enumeration 
    * Reliability: Alert is highly reliable

- HTTP Request Size Monitor Alert
    * Metric: WHEN sum() of http.request.bytes OVER all documents IS ABOVE 3500 FOR THE LAST 1 minute
    * Threshold: 3500
    * Vulnerability Mitigated: XSS, DDOS, Directory Traversal
    * Reliability: Alert is reliable, but can generate false positives
    
- CPU Usage Monitor Alert
    * Metric: WHEN max() OF system.process.cpu.total.pct OVER all documents IS ABOVE 0.5 FOR THE LAST 5 minutes
    * Threshold: 0.5
    * Vulnerability Mitigated: Malware & Viruses
    * Reliability: Alert is highly reliable
    
### Hardening
- System Hardening - Blocking scans
    * Set alerts for over 5000 connections per hour
    * Properly configure firewalls
    * Detect and block unauthorized scans
    * Conduct periodic assessments & audits
- System Hardening - SSH Hardening
    * Utilize a defense in depth concept
    * Enable public and private key encryption
    * Security enhanced modules
    * Disable root privileges for users
    * Local IP tables
    * Zero-trust
    * Least privilege
- System Hardening - Brute Force Attacks    
    * Alerts for 401 errors
    * 10 errors per hour
    * Set password policies
    * Blacklist IP addresses & egress filtering
    * Limit failed login attempts
    * Account policies & restrictions
- System Hardening - Directory Traversal
    * Implement a scanner
    * Web server software patches
    * Load Balancer & proxy
    * Filter URL requests
- System Hardening - Malicious Payloads & LFI
    * Set alerts for uploads into restricted directories
    * Alerts on ports 4444, 445, 80, 111, and 53.
    * Filter ports and close unused ports
    * Implement proper access controls
    * Require passwords with administrative (sudo) commands
- System Hardening - Firewalls
    * Firewall configuration/deployment:
        - Determine placement and identify requirements
        - Define rules
        - Allow necessary traffic and block unwanted traffic
        - Default config of disabling everything and enabling as needed
        - Implement stateful inspection
        - Enable logging and monitoring
        - Regularly update rules
        - Test and validate configurations
        - Backup configurations
        - Block incoming and outgoing traffic associated with unauthorized scanning activity
        - Note: manual/tedious tasks can be automated
- System Hardening - Malware
    * Implement an IDS/IPS & SOAR (SNORT, Suricata, Splunk)
        - Real-time alerts to events
        - Protection from the network layer and up
        - Automate response efforts to contain and neutralize threats
    * Utilize AV & EDR tools (Symantec, Ivanti, etc.)
        - Protects host from malicious programs
    * Logging & Monitoring (SIEM)
        - Splunk
        - ELK
        - Sentinel
        - Exabeam
- System Hardening - Application
    * Update WordPress service
    * Disable REST API & XML-RPC
        - Mitigates enumeration and XML-RPC exploitation
    * Disabling unused services mitigates enumeration and XML-RPC exploitation
    * If those services need to be utilized for application and business requirements, here are some actions that can be taken:
        - REST API Hardening: 
            * Authentication and Authorization: Use secure authentication methods (e.g., OAuth, JWT) to ensure only authorized users or systems can access the API. Enforce strict role-based access control (RBAC) to limit access to sensitive data and functions.
            * Rate Limiting and Throttling: Implement rate-limiting to prevent abuse or enumeration attempts by limiting the number of requests from a single IP or client. Use plugins like Limit Login Attempts Reloaded or server-level controls for throttling requests.
            * Disable Specific Endpoints: Use plugins like Disable WP REST API or code snippets to restrict access to sensitive REST API endpoints that are not required.
            * Monitor and Audit: Log and monitor API usage for unusual activity or signs of exploitation. Use security tools such as Wordfence to detect malicious API requests.
        - XML-RPC Hardening:
            * Authentication Controls: Require strong authentication for any XML-RPC requests, such as application-specific passwords or OAuth.
            * Limit XML-RPC Methods: Restrict access to only the XML-RPC methods that are explicitly needed (e.g., for remote publishing). Use the REST XML-RPC Data Checker plugin or custom code to block unused methods.
            * Prevent Brute Force Attacks: Install plugins like Wordfence or iThemes Security to block brute force attempts, especially against the `wp.getUsersBlogs` method.
            * Block Pingbacks: Disable the `pingback.ping` XML-RPC method to prevent DDoS amplification attacks. Add a filter to your `functions.php` file:
            ```
            add_filter('xmlrpc_methods', function($methods) {
                unset($methods['pingback.ping']);
                return $methods;
            });
            ```
            * Use a Web Application Firewall (WAF): Deploy a WAF to inspect and block malicious or abnormal XML-RPC requests. Services like Cloudflare, Sucuri, or ModSecurity can help.
        - General Best Practices:
            * Keep WordPress and Plugins Updated: Regularly update WordPress, plugins, and themes to patch known vulnerabilities.
            * Use HTTPS: Ensure all API communication is encrypted using HTTPS to prevent man-in-the-middle attacks.
            * Network Segmentation: Restrict access to the REST API or XML-RPC interface to specific IPs or networks when possible.
            * Use Security Plugins: Tools like Wordfence, Sucuri Security, or iThemes Security offer protection for both REST API and XML-RPC.
            * Monitor and Test: Regularly test your setup with vulnerability scanners to identify and mitigate risks.
        By combining these measures, you can maintain the functionality of REST API and XML-RPC while significantly reducing the associated risks.
    * Implement and properly configure a load balancer and accelerated domain.
        - Distributes traffic - mitigates DOS attacks
        - Optimizes resources and response
        - Train system to filter requests made to server, such as: `/?author=<number>” or “<script>`
    * Implement proper security controls to servers, systems, applications, and network.
        - Prevent unauthorized users from accessing sensitive, confidential, critical, and proprietary data.
- Provisioning User Access & Security
    * Implement least privilege, zero trust, and defense in depth concepts.
    * Implement SSO, MFA, and EPP.*
    * Proper access controls and baselines for secure configurations and operations.
        - What should be under direct control?
        - Secure restricted files and directories.
        - Secure user authentication and configuration information.
            * `wp-config.php`, `/wp-admin`, and `wp-login.php`
    * Secure network (e.g. VLANs, DMZ, airgaps, etc.)
    * Set alerts for authentication logs.
        - Anomalies & unauthorized access
    * Authentcation, Authorization, and Accounting (AAA)
- Employee Training & Awareness
    * Train employees on technology usage and best practices.
    * Training on corporate policies and regulations.
    * Implement best practices into processes (e.g ITIL, COBIT, NIST, ISO, etc.)
    * Compliance & Auditing (e.g SOX, HIPAA, PCI, GDPR, etc.)

### Implementing Patches
- Playbook Overview:
    * WordPress Patch - [wordpress.yml](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Defensive/Ansible/Updating_WordPress.yml)
        - File backups and archived data.
        - Installs latest version of WordPress.
    * ELK Stack Deployment - [elk.yml](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Defensive/Ansible/elk.yml)
        - Configures ELK with docker.
        - Use ELK to monitor activity.
    * Beats
        - Filebeat - helps collect file logs.
            * [filebeat.yml](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Defensive/Ansible/filebeat.yml)
        - Metricbeat - captures system metrics.
            * [metricbeat.yml](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Defensive/Ansible/metricbeat.yml)
        - Packetbeat - collects packet info for packet analysis.
            * [packetbeat.yml](https://github.com/aele1401/XCRP_PenTest/blob/main/RvB/Defensive/Ansible/packetbeat.yml)




        
        


    
    
    
    
    
    
    




    




